<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriAI Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Inter', sans-serif; } 
        /* Hide the Google Top Bar */
        .skiptranslate iframe { display: none !important; } 
        body { top: 0 !important; } 
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col relative overflow-x-hidden">
    
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-600 rounded-full mix-blend-multiply filter blur-[128px] opacity-40"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-purple-600 rounded-full mix-blend-multiply filter blur-[128px] opacity-40"></div>
    </div>

    <nav class="glass-panel w-full z-50 sticky top-0 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="/" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">AgriAI</a>
                
                <div class="hidden md:flex items-center space-x-4">
                    <a href="/" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Home</a>
                    <a href="/recommendation" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Crop</a>
                    <a href="/yield" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Yield</a>
                    <a href="/disease" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Disease</a>
                    <a href="/yolo" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-full text-sm font-bold transition">YOLO</a>

                    <div id="google_translate_element" class="hidden"></div> <select onchange="translatePage(this.value)" class="bg-gray-800 text-white text-sm border border-gray-600 rounded-lg px-2 py-1 focus:ring-2 focus:ring-green-500 outline-none cursor-pointer">
                        <option value="">üåê Language</option>
                        <option value="en">English</option>
                        <option value="hi">Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</option>
                        <option value="te">Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</option>
                        <option value="ta">Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)</option>
                        <option value="kn">Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</option>
                        <option value="mr">Marathi (‡§Æ‡§∞‡§æ‡§†‡•Ä)</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 relative z-10">
        {% block content %}{% endblock %}
    </main>

    <button onclick="toggleChat()" class="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full shadow-2xl flex items-center justify-center cursor-pointer hover:scale-110 transition transform z-50 border-2 border-white/20">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
    </button>

    <div id="chatWindow" class="fixed bottom-24 right-6 w-80 md:w-96 bg-gray-900/95 backdrop-blur-xl border border-gray-700 rounded-2xl shadow-2xl hidden flex-col z-50 overflow-hidden transform transition-all duration-300 origin-bottom-right scale-95 opacity-0">
        <div class="bg-gradient-to-r from-green-600 to-emerald-700 p-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
                <div><h3 class="font-bold text-white text-sm">AgriBot</h3><p class="text-green-100 text-xs">Llama 3 AI</p></div>
            </div>
            <select id="chatLang" class="bg-black/20 text-white text-xs border-none rounded px-2 py-1 focus:ring-0 cursor-pointer">
                <option value="English">üá¨üáß Eng</option>
                <option value="Hindi">üáÆüá≥ Hindi</option>
                <option value="Telugu">üáÆüá≥ Telugu</option>
            </select>
        </div>
        <div id="chatBody" class="h-80 overflow-y-auto p-4 space-y-3 bg-gray-900/50">
            <div class="flex justify-start"><div class="bg-gray-800 text-gray-200 rounded-tr-xl rounded-b-xl px-4 py-2 text-sm max-w-[85%] shadow-md border border-gray-700">Hello! I am your AI farming assistant. Ask me about crops, diseases, or weather! üå±</div></div>
        </div>
        <div class="p-3 bg-gray-800/80 border-t border-gray-700 flex gap-2">
            <input type="text" id="chatInput" placeholder="Ask something..." class="flex-1 bg-gray-900 text-white text-sm rounded-full px-4 py-2 border border-gray-600 focus:outline-none focus:border-green-500 transition" onkeypress="handleEnter(event)">
            <button onclick="sendMessage()" class="bg-green-600 hover:bg-green-500 text-white rounded-full p-2 shadow-lg transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></button>
        </div>
    </div>

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }
        
        // Custom Language Switcher Logic
        function translatePage(lang) {
            var frame = document.querySelector('.goog-te-combo');
            if (!frame) return;
            frame.value = lang;
            frame.dispatchEvent(new Event('change'));
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        function toggleChat() {
            const win = document.getElementById('chatWindow');
            if (win.classList.contains('hidden')) {
                win.classList.remove('hidden');
                setTimeout(() => win.classList.remove('scale-95', 'opacity-0'), 10);
            } else {
                win.classList.add('scale-95', 'opacity-0');
                setTimeout(() => win.classList.add('hidden'), 300);
            }
        }
        function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const body = document.getElementById('chatBody');
            const text = input.value.trim();
            if (!text) return;
            appendMessage(text, 'user');
            input.value = '';
            const loadingId = appendLoading();
            body.scrollTop = body.scrollHeight;
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, language: document.getElementById('chatLang').value })
                });
                const data = await response.json();
                document.getElementById(loadingId).remove();
                appendMessage(data.reply, 'bot');
            } catch (err) {
                document.getElementById(loadingId).remove();
                appendMessage("Error connecting.", 'bot');
            }
            body.scrollTop = body.scrollHeight;
        }
        function appendMessage(text, sender) {
            const body = document.getElementById('chatBody');
            const div = document.createElement('div');
            div.className = sender === 'user' ? 'flex justify-end' : 'flex justify-start';
            const bubble = document.createElement('div');
            bubble.className = sender === 'user' ? 'bg-blue-600 text-white rounded-tl-xl rounded-b-xl px-4 py-2 text-sm max-w-[85%] shadow-md' : 'bg-gray-800 text-gray-200 rounded-tr-xl rounded-b-xl px-4 py-2 text-sm max-w-[85%] shadow-md border border-gray-700';
            bubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
            div.appendChild(bubble);
            body.appendChild(div);
        }
        function appendLoading() {
            const id = 'loading-' + Date.now();
            const body = document.getElementById('chatBody');
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex justify-start';
            div.innerHTML = `<div class="bg-gray-800 rounded-tr-xl rounded-b-xl px-4 py-3 shadow-md border border-gray-700 flex gap-1"><div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div><div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></div></div>`;
            body.appendChild(div);
            return id;
        }
    </script>
</body>
</html>